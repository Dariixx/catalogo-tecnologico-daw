---
// src/pages/index.astro
import BaseLayout from "../layouts/BaseLayout.astro";
import ProductCard from "../components/ProductCard.astro";
import CategoryCard from "../components/CategoryCard.astro";
import ArticleCard from "../components/ArticleCard.astro";

// --- fetch existente (no tocar) ---
let featuredProducts = [];
let categories = [];
let articles = [];

try {
  const [productsRes, categoriesRes, articlesRes] = await Promise.all([
    fetch(`${import.meta.env.STRAPI_URL}/api/products?filters[featured][$eq]=true&populate=*&pagination[limit]=4`),
    fetch(`${import.meta.env.STRAPI_URL}/api/categories?populate=*&pagination[limit]=6`),
    fetch(`${import.meta.env.STRAPI_URL}/api/articles?populate=*&pagination[limit]=3&sort=publishedAt:desc`),
  ]);
  const productsData = await productsRes.json();
  const categoriesData = await categoriesRes.json();
  const articlesData = await articlesRes.json();

  featuredProducts = productsData?.data ?? [];
  categories = categoriesData?.data ?? [];
  articles = articlesData?.data ?? [];
} catch (e) {
  // silencioso en build
}
---

<BaseLayout
  title="ZetaGadget — Tu tienda tech de confianza"
  description="Descubre los mejores gadgets y productos tecnológicos. Envío rápido, precio justo."
>

  <!-- ═══════════════════════════════════════
       HERO
  ════════════════════════════════════════ -->
  <section class="relative flex flex-col items-center text-center py-20 sm:py-28 px-4 overflow-hidden">

    <!-- Glow central hero -->
    <div
      aria-hidden="true"
      class="pointer-events-none absolute inset-0 flex items-start justify-center"
    >
      <div
        class="w-[600px] h-[320px] rounded-full mt-4"
        style="background: radial-gradient(ellipse at center, rgba(30,136,229,0.13) 0%, transparent 70%); filter: blur(48px);"
      ></div>
    </div>

    <!-- Badge -->
    <div
      class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-xs font-medium mb-6 z-10"
      style="background: rgba(30,136,229,0.1); border: 1px solid rgba(30,136,229,0.25); color: #3aa0ff;"
    >
      <span class="w-1.5 h-1.5 rounded-full animate-pulse" style="background: #3aa0ff;"></span>
      Gadgets premium al mejor precio
    </div>

    <!-- Título -->
    <h1
      class="text-4xl sm:text-5xl lg:text-6xl font-bold leading-tight tracking-tight z-10 max-w-3xl"
      style="color: #e5e5e5;"
    >
      Tu tienda tech
      <span
        class="block mt-1"
        style="background: linear-gradient(90deg, #1e88e5 0%, #3aa0ff 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;"
      >
        de confianza
      </span>
    </h1>

    <!-- Subtítulo -->
    <p
      class="mt-5 text-base sm:text-lg max-w-xl leading-relaxed z-10"
      style="color: rgba(229,229,229,0.55);"
    >
      Explora cientos de productos tecnológicos seleccionados. Envío rápido, precios justos y atención real.
    </p>

    <!-- CTAs -->
    <div class="mt-8 flex flex-wrap items-center justify-center gap-3 z-10">
      <a
        href="/productos"
        class="px-6 py-3 rounded-xl text-sm font-semibold transition-all duration-200"
        style="background: #1e88e5; color: #fff; box-shadow: 0 4px 20px rgba(30,136,229,0.25);"
        onmouseover="this.style.background='#3aa0ff'; this.style.boxShadow='0 4px 28px rgba(30,136,229,0.4)';"
        onmouseout="this.style.background='#1e88e5'; this.style.boxShadow='0 4px 20px rgba(30,136,229,0.25)';"
      >
        Ver productos
      </a>

      <a
        href="/categorias"
        class="px-6 py-3 rounded-xl text-sm font-semibold transition-all duration-200"
        style="background: rgba(255,255,255,0.04); color: rgba(229,229,229,0.8); border: 1px solid rgba(255,255,255,0.1);"
        onmouseover="this.style.borderColor='rgba(30,136,229,0.4)'; this.style.color='#e5e5e5'; this.style.background='rgba(30,136,229,0.06)';"
        onmouseout="this.style.borderColor='rgba(255,255,255,0.1)'; this.style.color='rgba(229,229,229,0.8)'; this.style.background='rgba(255,255,255,0.04)';"
      >
        Explorar categorías
      </a>
    </div>

    <!-- Stats row -->
    <div
      class="mt-14 z-10 flex flex-wrap justify-center gap-x-10 gap-y-4"
      style="border-top: 1px solid rgba(255,255,255,0.06); padding-top: 2rem;"
    >
      {[
        { label: "Productos", value: "500+" },
        { label: "Categorías", value: "30+" },
        { label: "Clientes", value: "12k+" },
        { label: "Valoración media", value: "4.9★" },
      ].map((s) => (
        <div class="flex flex-col items-center gap-0.5">
          <span class="text-xl font-bold" style="color: #e5e5e5;">{s.value}</span>
          <span class="text-xs" style="color: rgba(229,229,229,0.4);">{s.label}</span>
        </div>
      ))}
    </div>
  </section>

  <!-- Divider -->
  <div class="w-full h-px" style="background: rgba(255,255,255,0.06);"></div>

  <!-- ═══════════════════════════════════════
       CATEGORÍAS
  ════════════════════════════════════════ -->
  <section class="py-16 sm:py-20">

    <!-- Header sección -->
    <div class="flex items-end justify-between mb-8 gap-4">
      <div>
        <p class="text-xs font-semibold uppercase tracking-widest mb-2" style="color: #1e88e5;">
          Explorar
        </p>
        <h2 class="text-2xl sm:text-3xl font-bold" style="color: #e5e5e5;">
          Categorías destacadas
        </h2>
      </div>

      <a
        href="/categorias"
        class="shrink-0 inline-flex items-center gap-1.5 text-sm font-medium transition-colors duration-200"
        style="color: rgba(229,229,229,0.5);"
        onmouseover="this.style.color='#3aa0ff';"
        onmouseout="this.style.color='rgba(229,229,229,0.5)';"
      >
        Ver todas
        <svg width="14" height="14" viewBox="0 0 14 14" fill="none" aria-hidden="true">
          <path d="M3 7h8M7.5 4l3 3-3 3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
      </a>
    </div>

    {categories.length > 0 ? (
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
        {categories.map((cat: any) => {
          const c = cat.attributes ?? cat;
          return (
            <CategoryCard
              category={{
                name: c.name,
                slug: c.slug,
                description: c.description,
              }}
            />
          );
        })}
      </div>
    ) : (
      <!-- Empty state categorías -->
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
        {Array.from({ length: 6 }).map(() => (
          <div
            class="h-36 rounded-xl animate-pulse"
            style="background: rgba(21,26,34,0.7); border: 1px solid rgba(255,255,255,0.05);"
          ></div>
        ))}
      </div>
    )}
  </section>

  <!-- Divider -->
  <div class="w-full h-px" style="background: rgba(255,255,255,0.06);"></div>

  <!-- ═══════════════════════════════════════
       PRODUCTOS DESTACADOS
  ════════════════════════════════════════ -->
  <section class="py-16 sm:py-20">

    <div class="flex items-end justify-between mb-8 gap-4">
      <div>
        <p class="text-xs font-semibold uppercase tracking-widest mb-2" style="color: #1e88e5;">
          Selección
        </p>
        <h2 class="text-2xl sm:text-3xl font-bold" style="color: #e5e5e5;">
          Productos destacados
        </h2>
      </div>

      <a
        href="/productos"
        class="shrink-0 inline-flex items-center gap-1.5 text-sm font-medium transition-colors duration-200"
        style="color: rgba(229,229,229,0.5);"
        onmouseover="this.style.color='#3aa0ff';"
        onmouseout="this.style.color='rgba(229,229,229,0.5)';"
      >
        Ver todos
        <svg width="14" height="14" viewBox="0 0 14 14" fill="none" aria-hidden="true">
          <path d="M3 7h8M7.5 4l3 3-3 3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
      </a>
    </div>

    {featuredProducts.length > 0 ? (
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-5">
        {featuredProducts.map((item: any) => {
          const p = item.attributes ?? item;
          const cat = p.category?.data?.attributes ?? p.category ?? null;
          return (
            <ProductCard
              product={{
                name: p.name,
                slug: p.slug,
                price: p.price,
                shortDescription: p.shortDescription ?? p.short_description,
                imageUrl: p.image?.data?.attributes?.url ?? p.imageUrl ?? null,
                featured: p.featured ?? false,
                stock: p.stock ?? 0,
                category: cat ? { name: cat.name, slug: cat.slug } : undefined,
              }}
            />
          );
        })}
      </div>
    ) : (
      <!-- Empty state productos -->
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-5">
        {Array.from({ length: 4 }).map(() => (
          <div
            class="rounded-xl overflow-hidden animate-pulse"
            style="background: rgba(21,26,34,0.7); border: 1px solid rgba(255,255,255,0.05);"
          >
            <div class="h-48" style="background: rgba(255,255,255,0.03);"></div>
            <div class="p-5 flex flex-col gap-3">
              <div class="h-3 rounded-full w-1/3" style="background: rgba(255,255,255,0.06);"></div>
              <div class="h-4 rounded-full w-3/4" style="background: rgba(255,255,255,0.06);"></div>
              <div class="h-3 rounded-full w-full" style="background: rgba(255,255,255,0.04);"></div>
              <div class="h-3 rounded-full w-2/3" style="background: rgba(255,255,255,0.04);"></div>
              <div class="h-9 rounded-lg mt-2" style="background: rgba(255,255,255,0.05);"></div>
            </div>
          </div>
        ))}
      </div>
    )}
  </section>

  <!-- Divider -->
  <div class="w-full h-px" style="background: rgba(255,255,255,0.06);"></div>

  <!-- ═══════════════════════════════════════
       BLOG
  ════════════════════════════════════════ -->
  <section class="py-16 sm:py-20">

    <div class="flex items-end justify-between mb-8 gap-4">
      <div>
        <p class="text-xs font-semibold uppercase tracking-widest mb-2" style="color: #1e88e5;">
          Blog
        </p>
        <h2 class="text-2xl sm:text-3xl font-bold" style="color: #e5e5e5;">
          Últimos artículos
        </h2>
      </div>

      <a
        href="/blog"
        class="shrink-0 inline-flex items-center gap-1.5 text-sm font-medium transition-colors duration-200"
        style="color: rgba(229,229,229,0.5);"
        onmouseover="this.style.color='#3aa0ff';"
        onmouseout="this.style.color='rgba(229,229,229,0.5)';"
      >
        Ver todos
        <svg width="14" height="14" viewBox="0 0 14 14" fill="none" aria-hidden="true">
          <path d="M3 7h8M7.5 4l3 3-3 3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
      </a>
    </div>

    {articles.length > 0 ? (
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5">
        {articles.map((item: any) => {
          const a = item.attributes ?? item;
          const author = a.author?.data?.attributes ?? a.author ?? null;
          return (
            <ArticleCard
              article={{
                title: a.title,
                slug: a.slug,
                description: a.description ?? a.excerpt,
                coverUrl: a.cover?.data?.attributes?.url ?? a.coverUrl ?? null,
                authorName: author?.name ?? a.authorName ?? null,
                publishedAt: a.publishedAt,
                readingTime: a.readingTime ?? a.reading_time ?? null,
              }}
            />
          );
        })}
      </div>
    ) : (
      <!-- Empty state blog -->
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5">
        {Array.from({ length: 3 }).map(() => (
          <div
            class="rounded-xl overflow-hidden animate-pulse"
            style="background: rgba(21,26,34,0.7); border: 1px solid rgba(255,255,255,0.05);"
          >
            <div class="h-44" style="background: rgba(255,255,255,0.03);"></div>
            <div class="p-5 flex flex-col gap-3">
              <div class="h-4 rounded-full w-4/5" style="background: rgba(255,255,255,0.06);"></div>
              <div class="h-3 rounded-full w-full" style="background: rgba(255,255,255,0.04);"></div>
              <div class="h-3 rounded-full w-2/3" style="background: rgba(255,255,255,0.04);"></div>
              <div class="flex gap-3 mt-1">
                <div class="h-3 rounded-full w-16" style="background: rgba(255,255,255,0.04);"></div>
                <div class="h-3 rounded-full w-20" style="background: rgba(255,255,255,0.04);"></div>
              </div>
            </div>
          </div>
        ))}
      </div>
    )}
  </section>

  <!-- ═══════════════════════════════════════
       BANNER CTA FINAL
  ════════════════════════════════════════ -->
  <section class="py-16">
    <div
      class="relative rounded-2xl overflow-hidden px-8 py-14 flex flex-col items-center text-center"
      style="background: #151a22; border: 1px solid rgba(30,136,229,0.2);"
    >
      <!-- Glow interior -->
      <div aria-hidden="true" class="pointer-events-none absolute inset-0 flex items-center justify-center">
        <div
          class="w-[500px] h-[200px] rounded-full"
          style="background: radial-gradient(ellipse at center, rgba(30,136,229,0.1) 0%, transparent 70%); filter: blur(40px);"
        ></div>
      </div>

      <h2 class="text-2xl sm:text-3xl font-bold z-10 max-w-lg" style="color: #e5e5e5;">
        ¿Buscas algo en concreto?
      </h2>
      <p class="mt-3 text-sm sm:text-base max-w-md z-10" style="color: rgba(229,229,229,0.5);">
        Usa nuestro buscador o navega por categorías para encontrar exactamente lo que necesitas.
      </p>

      <div class="mt-7 flex flex-wrap items-center justify-center gap-3 z-10">
        <a
          href="/productos"
          class="px-6 py-3 rounded-xl text-sm font-semibold transition-all duration-200"
          style="background: #1e88e5; color: #fff; box-shadow: 0 4px 20px rgba(30,136,229,0.25);"
          onmouseover="this.style.background='#3aa0ff';"
          onmouseout="this.style.background='#1e88e5';"
        >
          Buscar productos
        </a>

        <a
          href="/categorias"
          class="px-6 py-3 rounded-xl text-sm font-semibold transition-all duration-200"
          style="background: rgba(255,255,255,0.04); color: rgba(229,229,229,0.8); border: 1px solid rgba(255,255,255,0.1);"
          onmouseover="this.style.borderColor='rgba(30,136,229,0.4)'; this.style.color='#e5e5e5';"
          onmouseout="this.style.borderColor='rgba(255,255,255,0.1)'; this.style.color='rgba(229,229,229,0.8)';"
        >
          Ver categorías
        </a>
      </div>
    </div>
  </section>

</BaseLayout>