---
import "../styles/global.css";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import SEO from "../components/SEO.astro";

// Props tÃ­picos
const {
  title = "ZetaGadget",
  description = "",
  image, // puede ser absolute o relativa o undefined
  canonical, // puede ser relativa o undefined
} = Astro.props;

// Base del sitio (FRONT) para canonical/og:url
// IMPORTANTE: pon en .env SITE_URL=https://zetagadget.es
const SITE_URL = (import.meta.env.SITE_URL || Astro.site?.toString() || "").replace(/\/$/, "");

// Helper seguro para absolutas
const toAbsolute = (value) => {
  if (!value) return undefined;
  try {
    // Si ya es absoluta, perfecto
    if (typeof value === "string" && /^https?:\/\//i.test(value)) return value;
    // Si es relativa, la unimos al SITE_URL
    if (SITE_URL) return new URL(value, SITE_URL).toString();
  } catch {
    return undefined;
  }
  return undefined;
};

const canonicalUrl = toAbsolute(canonical || Astro.url.pathname);
const ogImage = toAbsolute(image);
---

<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <SEO
      title={title}
      description={description}
      canonical={canonicalUrl}
      image={ogImage}
    />
  </head>

  <body style="background:#0f1115;color:#e5e5e5;">
    <Header />
    <main class="min-h-[70vh]">
      <slot />
    </main>
    <Footer />
  </body>
</html>
