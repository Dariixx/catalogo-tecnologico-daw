---
import { site } from "../config/site";

const { brand } = Astro.props;

const navLinks = site.nav;
const currentPath = Astro.url.pathname;

const isActiveLink = (href) =>
  currentPath === href || (href !== "/" && currentPath.startsWith(href));
---

<header
  class="sticky top-0 z-50 w-full border-b"
  style="background: rgba(15,17,21,0.85); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border-color: rgba(255,255,255,0.08);"
>
  <div class="container-page">
    <div class="flex items-center justify-between h-20 sm:h-24 py-3 gap-3">
      <!-- Logo -->
      <a href="/" class="flex items-center gap-2 shrink-0 group min-w-0" aria-label="ZetaGadget">
        <img
          src="/brand/logo-nombre.png"
          alt="ZetaGadget"
          class="h-12 sm:h-20 w-auto shrink-0 transition-opacity duration-200 group-hover:opacity-85"
        />
      </a>

      <!-- Nav Desktop -->
      <nav class="hidden md:flex items-center gap-1">
        {navLinks.map((link) => {
          const active = isActiveLink(link.href);

          return (
            <a
              href={link.href}
              class={`relative px-4 py-2 text-sm font-medium rounded-md transition-colors duration-200 group ${
                active ? "text-white" : "hover:text-white"
              }`}
              style={active ? "color:#e5e5e5;" : "color: rgba(229,229,229,0.65);"}
              aria-current={active ? "page" : undefined}
            >
              <span
                class="absolute inset-0 rounded-md opacity-0 group-hover:opacity-100 transition-opacity duration-200"
                style="background: rgba(30,136,229,0.08);"
              ></span>

              <span class="relative z-10">{link.label}</span>

              {active ? (
                <span
                  class="absolute bottom-0 left-1/2 -translate-x-1/2 h-0.5 w-5 rounded-full"
                  style="background:#1e88e5;"
                ></span>
              ) : (
                <span
                  class="absolute bottom-0 left-1/2 -translate-x-1/2 h-0.5 w-0 rounded-full group-hover:w-5 transition-all duration-200"
                  style="background:#3aa0ff;"
                ></span>
              )}
            </a>
          );
        })}
      </nav>

      <!-- Right (Desktop + Mobile) -->
      <div class="flex items-center gap-3 shrink-0">
        <!-- Carrito (siempre visible) -->
        <button
          type="button"
          class="relative w-9 h-9 sm:w-10 sm:h-10 grid place-items-center rounded-lg"
          style="border: 1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.02);"
          aria-label="Carrito"
          data-open-cart
        >
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M6 6h15l-1.5 9h-12L6 6Z" stroke="rgba(229,229,229,0.9)" stroke-width="1.6" stroke-linejoin="round"/>
            <path d="M6 6 5 3H2" stroke="rgba(229,229,229,0.9)" stroke-width="1.6" stroke-linecap="round"/>
            <circle cx="9" cy="20" r="1.5" fill="rgba(229,229,229,0.9)"/>
            <circle cx="18" cy="20" r="1.5" fill="rgba(229,229,229,0.9)"/>
          </svg>

          <span
            id="cartBadge"
            class="absolute -top-2 -right-2 text-xs font-bold px-2 py-0.5 rounded-full hidden"
            style="background:#1e88e5;color:#fff;"
          >0</span>
        </button>

        <!-- Burger (solo móvil) -->
        <button
          id="menu-toggle"
          class="md:hidden flex flex-col justify-center items-center w-9 h-9 sm:w-10 sm:h-10 rounded-lg transition-colors duration-200 focus:outline-none"
          style="border: 1px solid rgba(255,255,255,0.08);"
          aria-label="Abrir menú"
          aria-expanded="false"
          type="button"
        >
          <span class="burger-line block w-5 h-0.5 mb-1 rounded transition-all duration-300" style="background:#e5e5e5;"></span>
          <span class="burger-line block w-5 h-0.5 mb-1 rounded transition-all duration-300" style="background:#e5e5e5;"></span>
          <span class="burger-line block w-5 h-0.5 rounded transition-all duration-300" style="background:#e5e5e5;"></span>
        </button>
      </div>
    </div>
  </div>

  <!-- Drawer Mobile -->
  <div
    id="mobile-menu"
    class="md:hidden overflow-hidden transition-all duration-300 ease-in-out"
    style="max-height:0; border-top:1px solid rgba(255,255,255,0.08);"
  >
    <nav class="flex flex-col px-4 py-3 gap-1" style="background:#151a22;">
      {navLinks.map((link) => {
        const active = isActiveLink(link.href);
        return (
          <a
            href={link.href}
            class="flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium transition-colors duration-200"
            style={
              active
                ? "color:#e5e5e5; background: rgba(30,136,229,0.12); border-left:2px solid #1e88e5;"
                : "color: rgba(229,229,229,0.65);"
            }
            aria-current={active ? "page" : undefined}
          >
            {link.label}
            {active && <span class="ml-auto w-1.5 h-1.5 rounded-full" style="background:#1e88e5;"></span>}
          </a>
        );
      })}

      <div class="pt-2 pb-1">
        <a
          href={site.primaryCta.href}
          class="block text-center px-4 py-2.5 text-sm font-semibold rounded-lg transition-all duration-200"
          style="background:#1e88e5; color:#fff;"
        >
          {site.primaryCta.label}
        </a>
      </div>
    </nav>
  </div>
</header>

<script type="module">
  // menú mobile
  const toggle = document.getElementById("menu-toggle");
  const menu = document.getElementById("mobile-menu");
  const lines = document.querySelectorAll(".burger-line");
  let open = false;

  toggle?.addEventListener("click", () => {
    open = !open;
    toggle.setAttribute("aria-expanded", String(open));
    if (open) {
      menu.style.maxHeight = menu.scrollHeight + "px";
      lines[0].style.transform = "translateY(6px) rotate(45deg)";
      lines[1].style.opacity = "0";
      lines[2].style.transform = "translateY(-6px) rotate(-45deg)";
    } else {
      menu.style.maxHeight = "0";
      lines[0].style.transform = "";
      lines[1].style.opacity = "1";
      lines[2].style.transform = "";
    }
  });

  menu?.querySelectorAll("a").forEach((a) => {
    a.addEventListener("click", () => {
      open = false;
      menu.style.maxHeight = "0";
      lines[0].style.transform = "";
      lines[1].style.opacity = "1";
      lines[2].style.transform = "";
    });
  });
</script>